## Renesas RX72N EnvisionKit with Toppers OS


This demo client and server run on "Toppers OS" and Renesas "RX72N EnvisionKit" with wolfSSL.


# Prerequisite


1.Renesas e² studio Version: 2022-07 (22.7.0) or later  
2.Renesas e² studio BSP   
3.Toppers OS 1.9.1 (Patch RX72N version)    
<br>
|element|name/version|
|:--|:--|
|Renesas e² studio Version|GR-2022-07 (22.7.0) or later|
|Toppers OS|1.9.3|
|Toppers Configurator|1.9.6|
|Renesas BSP r_bsp|7.10|
|Renesas BSP r_cmt_rx|5.10|
<br>

#The above version designations are limited to the versions used in order to make modifications to the designated versions as shown below.
# Build libraries
  # 1. Build the wolfSSL library
   Create the Toppers library and wolfSSL library required for this demo

  1-1.Press [Browse (R)] for [Select root directory (T)] in the [Import project] dialog
  
  1-2. Select [wolflib] from the git repository wolfssl/IDE/Renesas/e2studio/RX72N/EnvisionKit_Toppers Press [Select Folder]
  
  1-3. Click the created project in Project Explorer and select the [Build Project (B)] key from the pull-down menu to build.
  (When performing the above operations, make sure that [Toolchain:] is selected in the [Project] [Properties] [Settings] [toolchain] tab.)
  
  1-4. [libwolflib.a] is generated in [wolflib/Debug]

  # 2. Build TOPPERS library
  
  2-1.To build the Toppers library, download [asp-1.9.3 Renesas BSP version] from [https://www.toppers.jp/asp-d-download.html] and download [/wolfssl/ IDE/Renesas/e2studio/RX72N/EnvisionKit_Toppers/]
  
  2-2.To build the Toppers library, download [Configurator Release 1.9.6 (binary for Windows)] from [https://www.toppers.jp/cfg-download.html] and unzip it with [2.1] Create a [cfg/cfg] directory in the [asp] directory and extract it as [cfg.exe] inside
  
  2-3.Execute the shell script shown below to apply the patch.
    (Copy the files necessary for using EDMAC)
```
  $ pwd [Individual installation environment]/wolfssl/IDE/Renesas/e2studio/RX72N/EnvisionKit_Toppers
  ./setting.sh
```

  2-4. Confirmation of advance preparation

    Please prepare an environment such as Msys2 in advance for command execution.
    Install the gcc toolchain with Msys2.
    In the Msys2 environment, it is necessary to set the path of the Renesas environment in advance.bashrc etc.

--- Here is a setting example: Specify the Renesas toolchain path ---

```
$ export PATH=PATH=$PATH:\/C/ProgramData\/GCC\ for\ Renesas\ RX\ 8.3.0.202202-GNURX-ELF/rx-elf/rx-elf/bin
```

2-5. After confirming the settings, do the following

```
$ pwd [Individual installation environment]/wolfssl/IDE/Renesas/e2studio/RX72N/EnvisionKit_Toppers/asp
$ perl ./configure -T rx72n_gcc
$ make depend
```

  2-6. Project [Properties] → [C/C++ Build] → [Environment] dialog [Environment variable to set] [Add] button, enter [C_PROJECT] in [Name:] in [New variable] dialog , enter ${ProjDirPath} for [Value:]  
  
  2-7. Select [Open Project from File System...] in the menu

  2-8. Select [Toppers_app] from the git repository wolfssl/IDE/Renesas/e2studio/RX72N/EnvisionKit_Toppers Press [Select Folder]　　

  2-9. Click the created project in Project Explorer and select the [Build Project (B)] key from the pull-down menu to build.

  2-10.[toppers_rx] will generate [libasp.a]
 
# 3. Build the wolfSSLDemo project

  3-1. Select [Open Project from File System...] in the menu

  3-2. Select [wolfSSLDemo] from the git repository wolfssl/IDE/Renesas/e2studio/RX72N/EnvisionKit_Toppers Press [Select Folder]

  3-3.Double-click [WolfSSLDemo.scfg] to display the setting dialog → Select [Components tab]

  3.4. Click [Generate Code] on the upper right of the [Software Component Dialog] dialog.

  3.5. Select [Startup] [r_bsp] in the component selection on the left side of the dialog Right-click, select [Change version] from the context menu, and confirm that [Current version] is [7.10] (not [7.10] If so, select [7.10] in [Version after change:] and press [Next (N) >] to generate the code)

  3-6. Select [Drivers] [r_cmt_rx] in the component selection on the left side of the dialog, right-click, select [Change version] from the context menu, and confirm that [Current version] is [5.10] ([5.10 If it is not ], select [5.10] in [Changed version:] and press [Next (N) >] to generate the code)


   
  3-7. To apply the generated BSP to Toppers, modify it with the Patch command
  (If you cannot use the patch command with Msys2, you need to install it with [pacman -S patch])
  do the following
  ```
$pwd
[Individual installation environment]/wolfssl/IDE/Renesas/e2studio/RX72N/EnvisionKit_Toppers/WolfSSLDemo
  patch --binary -p0 < ./bsp.patch
```
Note:  
If you have used the smart configurator to generate code for [r_bsp],[r_cmt_rx], you will need to reapply the patch  
  
  3-8.[3-1.] After completion, select the [Build Project (B)] key from the pull-down menu to build.  
  
  3-9. Transfer the ELF file generated by the build to the board with [Menu] → [Run (R)] → [Run (R)] or [Debug (D)] and execute it  
  note:[T4_Library_ether_ccrx_rxv1_little] may be an error in the linker immediately after configuration/build Clear There is, but [T4_Library_ether_ccrx_rxv1_little] from [Linker]/[Archives]/[User defined archive (library) files (-I)]/[×] in [Settings] of the [Properties] dialog [C/C++ Build] of the project. Please delete it  
  
  3-10.If you define the define value [#define SSL_SERVER] in [WolfSSLDemo.c], it will operate as a server, and if you delete it, it will operate as a client (communication partners are linux, windows, mac created by  
  note:When operating as a client, [src/wolfDemo/wolf_demo.h]Server IP address define value [SERVER_IP] to "xxx.xx.xx.xx" Set the port number define value [SERVER_PortNo] as the port number  
  
  3-11. Check the execution in [Renesas Debug Virtual Console]
